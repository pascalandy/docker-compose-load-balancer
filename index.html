<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Docker compose load balancer by pascalandy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Docker compose load balancer</h1>
      <h2 class="project-tagline">A short demo on how to use Docker Compose to create a Web Service connected to a load balancer and a Redis Database. </h2>
      <a href="https://github.com/pascalandy/docker-compose-load-balancer" class="btn">View on GitHub</a>
      <a href="https://github.com/pascalandy/docker-compose-load-balancer/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/pascalandy/docker-compose-load-balancer/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="docker-compose-scaling-web-service-demo" class="anchor" href="#docker-compose-scaling-web-service-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>docker-compose scaling web service demo</h1>

<p>A short demo on how to use docker-compose to create a Web Service connected to a load balancer and a Redis Database. Be sure to check out my blog post on the full overview - <a href="https://www.brianchristner.io/how-to-scale-a-docker-container-with-docker-compose/">brianchristner.io</a></p>

<h1>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h1>

<p>The instructions assume that you have already installed <a href="https://docs.docker.com/installation/">Docker</a> and <a href="https://docs.docker.com/compose/install/">Docker Compose</a>. </p>

<p>In order to get started be sure to clone this project onto your Docker Host. Create a directory on your host. Please note that the demo webservices will inherit the name from the directory you create. If you create a folder named test. Then the services will all be named test-web, test-redis, test-lb. Also, when you scale your services it will then tack on a number to the end of the service you scale. </p>

<pre><code>git clone https://github.com/vegasbrianc/docker-compose-demo.git .
</code></pre>

<h1>
<a id="how-to-get-up-and-running" class="anchor" href="#how-to-get-up-and-running" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to get up and running</h1>

<p>Once you've cloned the project to your host we can now start our demo project. Easy! Navigate to the directory in which you cloned the project. Run the following commands from this directory 
    docker-compose up -d</p>

<p>The  docker-compose command will pull the images from Docker Hub and then link them together based on the information inside the docker-compose.yml file. This will create ports, links between containers, and configure applications as requrired. After the command completes we can now view the status of our stack</p>

<pre><code>docker-compose ps
</code></pre>

<p>Verify our service is running by either curlng the IP from the command line or view the IP from a web browser. You will notice that the each time you run the command the number of times seen is stored in the Redis Database which increments. The hostname is also reported.</p>

<h3>
<a id="curling-from-the-command-line" class="anchor" href="#curling-from-the-command-line" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Curling from the command line</h3>

<pre><code>curl 0.0.0.0

Hello World!
I have been seen 1 times.
My Host name is 29c69c89417c
</code></pre>

<h1>
<a id="scaling" class="anchor" href="#scaling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scaling</h1>

<p>Now comes the fun part of compose which is scaling. Let's scale our web service from 1 instance to 5 instances.</p>

<pre><code>docker-compose scale web=5
</code></pre>

<p>This will now scale our web service container. We now should run an update on our stack so the Loadbalancer is informed about the new web service containers. We had to update the command to add --force-recreate as the loadbalance was not being updated.</p>

<pre><code>docker-compose up --force-recreate -d
</code></pre>

<p>Now run our curl command again on our web services and we will now see the number of times increase and the hostname change. To get a deeper understanding tail the logs of the stack to watch what happens each time you access your web services.</p>

<pre><code>docker-compose logs
</code></pre>

<p>Here's the output from my docker-compose logs after I curled my application 5 times so it is clear that the round-robin is sent to all 5 web service containers.</p>

<pre><code>web_5   | 172.17.1.140 - - [04/Sep/2015 14:11:34] "GET / HTTP/1.1" 200 -
web_1   | 172.17.1.140 - - [04/Sep/2015 14:11:43] "GET / HTTP/1.1" 200 -
web_2   | 172.17.1.140 - - [04/Sep/2015 14:11:46] "GET / HTTP/1.1" 200 -
web_3   | 172.17.1.140 - - [04/Sep/2015 14:11:48] "GET / HTTP/1.1" 200 -
web_4   | 172.17.1.140 - - [04/Sep/2015 14:14:19] "GET / HTTP/1.1" 200 -
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/pascalandy/docker-compose-load-balancer">Docker compose load balancer</a> is maintained by <a href="https://github.com/pascalandy">pascalandy</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
